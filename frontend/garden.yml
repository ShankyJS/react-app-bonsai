# Builds the frontend React App
kind: Build
type: container
name: react-app
description: React App example
---
# Deploys the frontend React App
kind: Deploy
type: container
name: react-app
description: React App deployment example
build: react-app # Uses the build from the previous snippet
# If it was the case, we could set multiple dependencies
# to different tasks using the following syntax:
# dependencies: [deploy.backend] <--- Creates a dependency on the deploy task of the backend module

spec:
  args: [npm, start]
  ports:
    - name: http
      protocol: TCP
      containerPort: 3000
  ingresses:
    - path: /
      hostname: "react.${var.base-hostname}"
      port: http
  sync:
    command: [npm, start]
    sync:
      - source: ./src
        target: /app/src
        exclude: [node_modules]
      - source: package.json
        target: /package.json

---
# Setup tests
kind: Test
type: kubernetes-exec # <-- This means the test will be executed in the previously deployed container, saving time.
name: unit
description: Unit tests for the frontend React App
dependencies:
  - deploy.react-app # <-- This means the test will be executed after the deploy task of the frontend module
spec:
  args: ["npm", "test"]
  resource:
    kind: Deployment
    name: react-app
